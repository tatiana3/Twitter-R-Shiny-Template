---
output: html_document
runtime: shiny
---

<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{r, echo = FALSE}
library(DT)
library(shiny)
#library(shinyjs)
#library(ggplot2)
#library(shinydashboard)
library(shinyalert)
#library(lubridate)
useShinyalert()


setwd("~/Desktop/Research")

data123 <- read.csv("out0MergeUnique.csv")

dt_output = function(title, id) {
  fluidRow(column(
    12, h1(paste0('Table ', sub('.*?([0-9]+)$', '\\1', id), ': ', title)),
    hr(), DTOutput(id)
  ))
}

render_dt = function(data, editable = 'cell', server = TRUE, ...) {
  renderDT(data, selection = 'none', server = server, editable = editable, ...)
}

ui <- 

fluidPage(
  titlePanel("Parkland Shooting Data"),
  
  

  # Create a new Row in the UI for selectInputs
  fluidRow(
    column(4,
        selectInput("med",
                    "Medium:",
                    c("All",
                      unique(as.character(data123$medium))))
    ),
    column(4,
        selectInput("typ",
                    "Type:",
                    c("All",
                      unique(as.character(data123$type))))
    ),
  ),
  
  tags$head(tags$style(".butt{background-color:#230682;} .butt{color: #e6ebef;}")),
  downloadButton("Trich_csv", "Download in CSV", class="butt"),
  useShinyalert(), # Set up shinyalert
  uiOutput("MainBody_trich"),actionButton(inputId = "Updated_trich",label = "Save"),
  
  dt_output('client-side processing', 'x1'),
  
  dt_output('server-side processing', 'x5'),
  # Create a new row for the table.
  DT::dataTableOutput("table")
)

server <- function(input, output) {
  
  output$table <- DT::renderDataTable(DT::datatable({
    data <- data123
    
    output$x1 = render_dt(data, 'cell', FALSE)
    observe(str(input$x1_cell_edit))
    output$x5 = render_dt(ddata, 'cell')
    
    proxy5 = dataTableProxy('x5')
    observeEvent(input$x5_cell_edit, {
      info = input$x5_cell_edit
      str(info)  # check what info looks like (a data frame of 3 columns)
      d5 <<- editData(data, info)
      replaceData(proxy5, data, resetPaging = FALSE)  # important
      # the above steps can be merged into a single editData() call; see examples below
    })
  
    if (input$med != "All") {
      data <- data[data$medium == input$med,]
    }
    if (input$typ != "All") {
      data <- data[data$type == input$typ,]
    }
    
    
    observeEvent(input$Updated_trich,{
    saveRDS(vals_trich$Data, "note.rds")
    shinyalert(title = "Saved!", type = "success")
  })
    output$Trich_csv<- downloadHandler(
    filename = function() {
      paste("Parkland Filtered", Sys.Date(), ".csv", sep="")
    },
    content = function(file) {
      write.csv(data.frame(data123), file, row.names = F)
    }
  )
    
    options = list(autoWidth = FALSE, scrollX = TRUE)
    data
    
    
  
  }))
}
  
shinyApp(ui, server)
```

